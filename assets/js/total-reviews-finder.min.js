function total_reviews_init(e){var t=document.querySelector("#"+e.widgetId);if(t){var a=t.querySelector(".total_reviews-search-btn");WPacFastjs.on(a,"click",function(){var a=t.querySelector(".total_reviews-place-search");return console.log("request"),a.value?(/^ChIJ.*$/.test(a.value)?jQuery.get(total_reviews_request_url("reviews"),{placeid:a.value,total_reviews_wpnonce:jQuery("#total_reviews_nonce").val()},function(a){console.log(a),total_reviews_addPlaces(t,[a],e.cb)},"json"):total_reviews_textsearch(t,a.value,e.cb),!1):(a.focus(),!1)}),total_reviews_jquery_init(t,e.cb)}}function total_reviews_mod_init(e){var t=document.querySelector("#"+e.widgetId);t&&(jQuery.get(total_reviews_request_url("places"),{total_reviews_wpnonce:jQuery("#total_reviews_nonce").val()},function(a){var r=t.querySelector(".wp-places");a.places.length<1?r.innerHTML="There are no Places yet":(r.innerHTML="",WPacFastjs.each(a.places,function(a){var s=document.createElement("div");s.className="total-reviews-place media",s.innerHTML=total_reviews_renderPlace(a),s.title=a.formatted_address,r.appendChild(s),s.querySelector(".total-reviews-gstars").innerHTML=WPacStars.rating_render(a.rating,14,"e7711b"),WPacFastjs.on(s,"click",function(){var r=s.parentNode.querySelector(".total-reviews-active");return WPacFastjs.remcl(r,"total-reviews-active"),WPacFastjs.addcl(s,"total-reviews-active"),jQuery.get(total_reviews_request_url("place_reviews"),{google_place_id:a.id,total_reviews_wpnonce:jQuery("#total_reviews_nonce").val()},function(r){var s=t.querySelector(".wp-reviews");r.reviews.length<1?s.innerHTML="There are no reviews yet for selected Place":(s.innerHTML="",t.querySelector(".total-reviews-google-place-name").value=a.name,t.querySelector(".total-reviews-google-place-id").value=a.place_id,WPacFastjs.show2(t.querySelector("#mod-reviews")),WPacFastjs.show2(t.querySelector("#mod-shortcode-builder")),e.cb&&e.cb(),WPacFastjs.each(r.reviews,function(e){var t=document.createElement("div");t.className="total-reviews-place media",t.innerHTML=total_reviews_renderReview(e,!0),s.appendChild(t),t.querySelector(".total-reviews-gstars").innerHTML=WPacStars.rating_render(e.rating,14,"e7711b"),WPacFastjs.on2(t,".wp-google-delete","click",function(){return confirm("Are you sure to delete this review?")&&jQuery.post(total_reviews_request_url("delete_review"),{google_review_id:e.id,total_reviews_wpnonce:jQuery("#total_reviews_nonce").val()},function(e){"success"==e.status&&WPacFastjs.rm(t)},"json"),!1})}))},"json"),!1})}))},"json"),total_reviews_jquery_init(t,e.cb))}function total_reviews_jquery_init(e,t){jQuery(document).ready(function(a){var r;a(".total-reviews-place-photo-btn",e).on("click",function(s){s.preventDefault();{if(!r)return(r=wp.media.frames.file_frame=wp.media({title:a(this).data("uploader_title"),button:{text:a(this).data("uploader_button_text")},multiple:!1})).on("select",function(){var s=a(".total-reviews-place-photo",e),i=a(".total-reviews-place-photo-img",e);attachment=r.state().get("selection").first().toJSON(),s.val(attachment.url),i.attr("src",attachment.url),i.show(),t&&t()}),r.open(),!1;r.open()}}),a(".rplg-options-toggle",e).unbind("click").click(function(){a(this).toggleClass("toggled"),a(this).next().slideToggle()})})}function total_reviews_textsearch(e,t,a){jQuery.get(total_reviews_request_url("search"),{query:t,total_reviews_wpnonce:jQuery("#total_reviews_nonce").val()},function(t){total_reviews_addPlaces(e,t,a)},"json")}function total_reviews_addPlaces(e,t,a){var r=e.querySelector(".total-reviews-places");t&&t.length?(r.innerHTML="",WPacFastjs.each(t,function(s){var i=document.createElement("div");i.className="total-reviews-place media",i.innerHTML=total_reviews_renderPlace(s),i.title=s.formatted_address,r.appendChild(i),i.querySelector(".total-reviews-gstars").innerHTML=WPacStars.rating_render(s.rating,14,"e7711b"),total_reviews_selectPlace(e,s.place_id,i,a),1==t.length?(i.className="total-reviews-place total-reviews-active media",jQuery.get(total_reviews_request_url("reviews"),{placeid:s.place_id,total_reviews_wpnonce:jQuery("#total_reviews_nonce").val()},function(t){total_reviews_addReviews(e,t,a)},"json")):e.querySelector(".total-reviews-reviews").innerHTML=""})):r.innerHTML='<div class="wp-place-info">Google Place not found.<br><br>Please check that this place can be found in <a href="https://developers.google.com/maps/documentation/javascript/examples/places-placeid-finder" target="_blank">Google PlaceID Finder</a>, if so, then copy <b>Place ID</b> to a search field and try to find again.</div>'}function total_reviews_selectPlace(e,t,a,r){WPacFastjs.on(a,"click",function(){var s=a.parentNode.querySelector(".total-reviews-active");return WPacFastjs.remcl(s,"total-reviews-active"),WPacFastjs.addcl(a,"total-reviews-active"),jQuery.get(total_reviews_request_url("reviews"),{placeid:t,total_reviews_wpnonce:jQuery("#total_reviews_nonce").val()},function(t){total_reviews_addReviews(e,t,r)},"json"),!1})}function total_reviews_addReviews(e,t,a){var r=e.querySelector(".total-reviews-reviews");if(t&&t.reviews&&t.reviews.length){r.innerHTML="";for(var s=0;s<t.reviews.length;s++){var i=document.createElement("div");i.className="total-reviews-place media",i.innerHTML=total_reviews_renderReview(t.reviews[s]),r.appendChild(i),i.querySelector(".total-reviews-gstars").innerHTML=WPacStars.rating_render(t.reviews[s].rating,14,"e7711b")}WPacFastjs.show2(e.querySelector(".total-reviews-five-reviews-note")),total_reviews_saveReviews(e,t,a)}else r.innerHTML="There are no reviews yet."}function total_reviews_saveReviews(e,t,a){var r=e.querySelector(".total-reviews-save-reviews-container");r.innerHTML="";var s=document.createElement("button");s.innerHTML="Save Place and Reviews",s.className="total-reviews-save-reviews btn btn-primary btn-block",r.appendChild(s);var i=total_reviews_show_tooltip(r,"Please click by 'Save Place and Reviews' button.");WPacFastjs.on(s,"click",function(){return s.disabled=!0,jQuery.post(total_reviews_request_url("save"),{placeid:t.place_id,total_reviews_wpnonce:jQuery("#total_reviews_nonce").val()},function(r){s.disabled=!1,WPacFastjs.rm(i),e.querySelector(".total-reviews-google-place-name").value=t.name,e.querySelector(".total-reviews-google-place-id").value=t.place_id;var l=e.parentNode.parentNode.querySelector(".widget-control-actions");l&&total_reviews_show_tooltip(l,"Please don't forget to <b>Save</b> the widget."),a&&a(e,t)},"json"),!1})}function total_reviews_renderPlace(e){return'<div class="media-left"><img class="media-object" src="'+e.icon+'" alt="'+e.name+'" style="width:32px;height:32px;"></div><div class="media-body"><h5 class="media-heading">'+e.name+'</h5><div><span class="total-reviews-grating">'+e.rating+'</span><span class="total-reviews-gstars"></span></div><small class="text-muted">'+(e.formatted_address||e.address)+"</small></div>"}function total_reviews_renderReview(e,t){return'<div class="media-left"><img class="media-object" src="'+e.profile_photo_url+'" alt="'+e.author_name+'" onerror="if(this.src!=\''+total_reviewsVars.GOOGLE_AVATAR+"')this.src='"+total_reviewsVars.GOOGLE_AVATAR+'\';"></div><div class="media-body"><div class="media-heading"><a href="'+e.author_url+'" target="_blank">'+e.author_name+'</a></div><div class="total-reviews-gtime">'+WPacTime.getTime(1e3*parseInt(e.time),"en","ago")+'</div><div class="total-reviews-gtext"><span class="total-reviews-gstars"></span> '+total_reviews_small_text(e.text)+"</div>"+(t?'<a class="wp-google-delete" href="#"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="14" height="14" viewBox="0 0 1792 1792"><path d="M704 1376v-704q0-14-9-23t-23-9h-64q-14 0-23 9t-9 23v704q0 14 9 23t23 9h64q14 0 23-9t9-23zm256 0v-704q0-14-9-23t-23-9h-64q-14 0-23 9t-9 23v704q0 14 9 23t23 9h64q14 0 23-9t9-23zm256 0v-704q0-14-9-23t-23-9h-64q-14 0-23 9t-9 23v704q0 14 9 23t23 9h64q14 0 23-9t9-23zm-544-992h448l-48-117q-7-9-17-11h-317q-10 2-17 11zm928 32v64q0 14-9 23t-23 9h-96v948q0 83-47 143.5t-113 60.5h-832q-66 0-113-58.5t-47-141.5v-952h-96q-14 0-23-9t-9-23v-64q0-14 9-23t23-9h309l70-167q15-37 54-63t79-26h320q40 0 79 26t54 63l70 167h309q14 0 23 9t9 23z" fill="#666"></path></svg> Delete</a>':"")+"</div>"}function total_reviews_show_tooltip(e,t){var a=WPacFastjs.create("div","total_reviews-tooltip");return a.innerHTML='<div class="total-reviews-corn1"></div><div class="total-reviews-corn2"></div><div class="total-reviews-close">Ã—</div><div class="total-reviews-text">'+t+"</div>",e.appendChild(a),setTimeout(function(){WPacFastjs.addcl(a,"total-reviews-tooltip-visible")},100),WPacFastjs.on2(a,".total-reviews-close","click",function(){WPacFastjs.rm(a)}),a}function total_reviews_small_text(e){var t=e,a=!1;if(e&&e.length>100){var r=e.lastIndexOf(" ",100);(r=r>0?r:100)>0&&(t=e.substring(0,r),a=e.substring(r,e.length))}var s={t:t,h:a};return doT.template('{{!it.t}} {{?it.h}}<span class="wp-more" style="display:none">{{!it.h}}</span><span class="wp-more-toggle" onclick="this.previousSibling.style=\'\';this.textContent=\'\';" style="color:#136aaf;cursor:pointer;text-decoration:underline">read more</span>{{?}}')(s)}function total_reviews_request_url(e){return total_reviewsVars.handlerUrl+"&cf_action="+total_reviewsVars.actionPrefix+"_"+e+"&v="+(new Date).getTime()}